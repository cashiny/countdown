<body>
    <div id="imageContainer" style="margin-bottom: 1rem; display: none;">
        <img id="displayedImage" alt="Selected Image" style="max-width: 100%; max-height: 200px; border: 1px solid #ccc; border-radius: 0.5rem;" />
    </div>
    <h1>Countdown to <div id="purpose" class="h1" style="display: inline">Freedom!</div></h1>
    <div id="countdown">
        <div class="unit"><div id="days" class="number">00</div><div class="label">Days</div></div>
        <div class="unit"><div id="hours" class="number">00</div><div class="label">Hours</div></div>
        <div class="unit"><div id="minutes" class="number">00</div><div class="label">Minutes</div></div>
        <div class="unit"><div id="seconds" class="number">00</div><div class="label">Seconds</div></div>
    </div>

    <script>
        const DEFAULT_END_TIME = "2026-08-01";

        function getQueryParam(param) {
            const params = new URLSearchParams(window.location.search);
            return params.get(param);
        }

        function getEndTime() {
            const endParam = getQueryParam('end') || DEFAULT_END_TIME;

            // Allow epoch milliseconds or ISO date strings
            const asNumber = Number(endParam);
            if (!isNaN(asNumber)) {
                return new Date(asNumber);
            }

            // Convert date string to local time
            const inputDate = new Date(endParam);
            if (isNaN(inputDate.getTime())) return null;

            // Adjust to local time if input was interpreted as UTC
            const localOffset = inputDate.getTimezoneOffset() * 60000;
            return new Date(inputDate.getTime() + localOffset);
        }

        // Display selected image if the 'img' query parameter is provided
        const imageUrl = getQueryParam('img');
        if (imageUrl) {
            const imageContainer = document.getElementById('imageContainer');
            const displayedImage = document.getElementById('displayedImage');
            displayedImage.src = imageUrl;
            imageContainer.style.display = 'block';
        }

        const purpose = getQueryParam('p');
        if (purpose) {
            document.getElementById('purpose').textContent = purpose;
        }

        const endTime = getEndTime();
        if (endTime == null) {
            document.getElementById('countdown').textContent = 'No valid "end" parameter provided.';
        } else {
            function updateCountdown() {
                const now = new Date();
                const diff = endTime - now;
                if (diff <= 0) {
                    document.getElementById('countdown').textContent = 'Countdown complete!';
                    clearInterval(interval);
                    return;
                }

                const secondsTotal = Math.floor(diff / 1000);
                const days = Math.floor(secondsTotal / 86400);
                const hours = Math.floor((secondsTotal % 86400) / 3600);
                const minutes = Math.floor((secondsTotal % 3600) / 60);
                const seconds = secondsTotal % 60;

                document.getElementById('days').textContent = String(days).padStart(2, '0');
                document.getElementById('hours').textContent = String(hours).padStart(2, '0');
                document.getElementById('minutes').textContent = String(minutes).padStart(2, '0');
                document.getElementById('seconds').textContent = String(seconds).padStart(2, '0');
            }

            updateCountdown();
            const interval = setInterval(updateCountdown, 1000);
        }
    </script>
</body>